/*
* Angular SDK to use with backand 
* @version 1.7.0 - 2015-07-30
* @link https://backand.com 
* @author Itay Herskovits 
* @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(){"use strict";var a=/\?(data|error)=(.+)/,b=a.exec(location.href);if(b&&b[1]&&b[2]){var c={};c[b[1]]=JSON.parse(decodeURI(b[2].replace(/#.*/,""))),window.opener.postMessage(JSON.stringify(c),location.origin)}var d,e,f,g,h,i;angular.module("backand",["ngCookies"]).provider("Backand",function(){function a(a){function c(a,b){var c=m[a],d=b?"up":"in";return"user/socialSign"+d+"?provider="+c.label+"&response_type=token&client_id=self&redirect_uri="+c.url+"&state=rcFNVUMsUOSNMJQZ%2bDTzmpqaGgSRGhUfUOyQHZl6gas%3d"}function j(a){if(l.socialAuthWindow.close(),l.socialAuthWindow=null,a.origin===location.origin){var b=JSON.parse(a.data);return b.error?void l.loginPromise.reject({data:b.error.message+" (signing in with "+b.error.provider+")"}):b.data?l.signInWithToken(b.data):void l.loginPromise.reject()}}function k(a){return g.remove(),f.clear(),i({method:"POST",url:e.apiUrl+"/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];return angular.forEach(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.join("&")},data:a}).success(function(a){angular.isDefined(a)&&null!=a?angular.isDefined(a.access_token)&&(e.token="bearer "+a.access_token,g.set(e.token),f.set(),h.set(a),l.loginPromise.resolve(e.token)):l.loginPromise.reject("token is undefined")}).error(function(a){l.loginPromise.reject(a)}),l.loginPromise.promise}var l=this,m={github:{name:"github",label:"Github",url:"www.github.com",css:"github",id:1},google:{name:"google",label:"Google",url:"www.google.com",css:"google-plus",id:2},facebook:{name:"facebook",label:"Facebook",url:"www.facebook.com",css:"facebook",id:3}};l.getSocialProviders=function(){return m},l.socialSignIn=function(a,c,d){return d&&b.setAppName(d),l.socialAuth(a,c,!1)},l.socialSignUp=function(a,c,d){return d&&b.setAppName(d),l.socialAuth(a,c,!0)},l.socialAuth=function(b,d,f){return l.loginPromise=a.defer(),d=d||encodeURIComponent(location.href.replace(/\?.*/g,"")),l.socialAuthWindow=window.open("https://api.backand.com:8079/1/"+c(b,f)+"&appname="+e.appName+"&returnAddress=","id1","left=10, top=10, width=600, height=600"),window.addEventListener("message",j,!1),l.loginPromise.promise},l.signin=function(c,d,f){l.loginPromise=a.defer(),f&&b.setAppName(f);var g={grant_type:"password",username:c,password:d,appname:e.appName};return k(g)},l.signInWithToken=function(a){var b={grant_type:"password",accessToken:a.access_token,appName:e.appName};return k(b)},l.getUserDetails=function(b){var c=a.defer();return b?i({method:"GET",url:e.apiUrl+"/1/account/profile"}).success(function(a){h.set(a),c.resolve(h.get())}):c.resolve(h.get()),c.promise},l.getUsername=function(){var a=d.get(e.userProfileName);return a?a.username:null},l.getUserRole=function(){var a=d.get(e.userProfileName);return a?a.role:null},l.signout=function(){return g.remove(),h.remove(),f.clear(),f.set(),a.when(!0)},l.signup=function(a,c,d,f,g,h){return h&&b.setAppName(h),i({method:"POST",url:e.apiUrl+"/1/user/signup",headers:{SignUpToken:e.signUpToken},data:{firstName:a,lastName:c,email:d,password:f,confirmPassword:g}})},l.requestResetPassword=function(a,c){return c&&b.setAppName(c),i({method:"POST",url:e.apiUrl+"/1/user/requestResetPassword",data:{appName:e.appName,username:a}})},l.resetPassword=function(a,b){return i({method:"POST",url:e.apiUrl+"/1/user/resetPassword",data:{newPassword:a,resetToken:b}})},l.changePassword=function(a,b){return i({method:"POST",url:e.apiUrl+"/1/user/changePassword",data:{oldPassword:a,newPassword:b}})},l.getToken=function(){return g.get()},l.getTokenName=function(){return e.tokenName},l.getApiUrl=function(){return e.apiUrl}}var b=this;e={apiUrl:"https://api.backand.com:8080",tokenName:"backand_token",anonymousToken:null,signUpToken:null,isManagingDefaultHeaders:!1,appName:null,userProfileName:"backand_user"},g={get:function(){return d.get(e.tokenName)},set:function(a){d.put(e.tokenName,a)},remove:function(){d.remove(e.tokenName)}},h={get:function(){return d.get(e.userProfileName)},set:function(a){d.put(e.userProfileName,a)},remove:function(){d.remove(e.userProfileName)}},f={set:function(){if(e.isManagingDefaultHeaders){var a=g.get();angular.isDefined(a)&&(i.defaults.headers.common.Authorization=a),e.anonymousToken&&(i.defaults.headers.common.AnonymousToken=e.anonymousToken)}},clear:function(){e.isManagingDefaultHeaders&&(i.defaults.headers.common.Authorization&&delete i.defaults.headers.common.Authorization,i.defaults.headers.common.AnonymousToken&&delete i.defaults.headers.common.AnonymousToken)}},this.getApiUrl=function(){return e.apiUrl},this.setApiUrl=function(a){return e.apiUrl=a,this},this.getTokenName=function(a){return e.tokenName},this.setTokenName=function(a){return e.tokenName=a,this},this.setAnonymousToken=function(a){return e.anonymousToken=a,this},this.setSignUpToken=function(a){return e.signUpToken=a,this},this.setAppName=function(a){return e.appName=a,this},this.manageDefaultHeaders=function(a){return void 0==a&&(a=!0),e.isManagingDefaultHeaders=a,this},this.$get=["$q",function(b){return new a(b)}]}).run(["$injector","$location",function(a,b){a.invoke(["$http","$cookieStore",function(a,b){d=b,i=a}]),f.set()}])}();