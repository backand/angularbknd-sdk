/*
* Angular SDK to use with backand 
* @version 1.7.1 - 2015-07-21
* @link https://backand.com 
* @author Itay Herskovits 
* @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(){"use strict";var a,b,c,d,e,f;angular.module("backand",["ngCookies"]).provider("Backand",function(){function g(g){function h(a,b){var c=l[a],d=b?"up":"in";return"user/socialSign"+d+"?provider="+c.label+"&response_type=token&client_id=self&redirect_uri="+c.url+"&state=rcFNVUMsUOSNMJQZ%2bDTzmpqaGgSRGhUfUOyQHZl6gas%3d"}function i(a){if(a.origin===location.origin){var b=JSON.parse(a.data);return b.error?void k.loginPromise.reject({data:b.error.message+" (signing in with "+b.error.provider+")"}):b.data?k.signInWithToken(b.data):void k.loginPromise.reject()}}function j(a){return d.remove(),c.clear(),f({method:"POST",url:b.apiUrl+"/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];return angular.forEach(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.join("&")},data:a}).success(function(a){angular.isDefined(a)&&null!=a?angular.isDefined(a.access_token)&&(b.token="bearer "+a.access_token,d.set(b.token),c.set(),e.set(a),k.loginPromise.resolve(b.token)):k.loginPromise.reject("token is undefined")}).error(function(a){k.loginPromise.reject(a)}),k.loginPromise.promise}var k=this,l={github:{name:"github",label:"Github",url:"www.github.com",css:"github",id:1},google:{name:"google",label:"Google",url:"www.google.com",css:"google-plus",id:2},facebook:{name:"facebook",label:"Facebook",url:"www.facebook.com",css:"facebook",id:3}};k.getSocialProviders=function(){return l},k.socialSignIn=function(a,b){return k.socialAuth(a,b,!1)},k.socialSignUp=function(a,b){return k.socialAuth(a,b,!0)},k.socialAuth=function(a,c,d){return k.loginPromise=g.defer(),c=c||encodeURIComponent(location.href.replace(/\?.*/g,"")),window.open("https://api.backand.com:8079/1/"+h(a,d)+"&appname="+b.appName+"&returnAddress=","id1","left=10,top=10,width=600,height=600"),window.addEventListener("message",i,!1),k.loginPromise.promise},k.signin=function(a,c,d){k.loginPromise=g.defer(),d&&k.setAppName(d);var e={grant_type:"password",username:a,password:c,appname:b.appName};return j(e)},k.signInWithToken=function(a){var c={grant_type:"password",accessToken:a.access_token,appName:b.appName};return j(c)},k.getUserDetails=function(){return a.get(b.userProfileName)},k.getUsername=function(){var c=a.get(b.userProfileName);return c?c.username:null},k.getUserRole=function(){var c=a.get(b.userProfileName);return c?c.role:null},k.signout=function(){return d.remove(),e.remove(),c.clear(),c.set(),g.when(!0)},k.signup=function(a,c,d,e,g){return f({method:"POST",url:b.apiUrl+"/1/user/signup",headers:{SignUpToken:b.signUpToken},data:{firstName:a,lastName:c,email:d,password:e,confirmPassword:g}})},k.requestResetPassword=function(a,c){return c&&k.setAppName(c),f({method:"POST",url:b.apiUrl+"/1/user/requestResetPassword",data:{appName:b.appName,username:a}})},k.resetPassword=function(a,c){return f({method:"POST",url:b.apiUrl+"/1/user/resetPassword",data:{newPassword:a,resetToken:c}})},k.changePassword=function(a,c){return f({method:"POST",url:b.apiUrl+"/1/user/changePassword",data:{oldPassword:a,newPassword:c}})},k.getToken=function(){return d.get()},k.getTokenName=function(){return b.tokenName},k.getApiUrl=function(){return b.apiUrl}}b={apiUrl:"https://api.backand.com:8080",tokenName:"backand_token",anonymousToken:null,signUpToken:null,isManagingDefaultHeaders:!1,appName:null,userProfileName:"backand_user"},d={get:function(){return a.get(b.tokenName)},set:function(c){a.put(b.tokenName,c)},remove:function(){a.remove(b.tokenName)}},e={get:function(){return a.get(b.userProfileName)},set:function(c){a.put(b.userProfileName,c)},remove:function(){a.remove(b.userProfileName)}},c={set:function(){if(b.isManagingDefaultHeaders){var a=d.get();angular.isDefined(a)&&(f.defaults.headers.common.Authorization=a),b.anonymousToken&&(f.defaults.headers.common.AnonymousToken=b.anonymousToken)}},clear:function(){b.isManagingDefaultHeaders&&(f.defaults.headers.common.Authorization&&delete f.defaults.headers.common.Authorization,f.defaults.headers.common.AnonymousToken&&delete f.defaults.headers.common.AnonymousToken)}},this.getApiUrl=function(){return b.apiUrl},this.setApiUrl=function(a){return b.apiUrl=a,this},this.getTokenName=function(){return b.tokenName},this.setTokenName=function(a){return b.tokenName=a,this},this.setAnonymousToken=function(a){return b.anonymousToken=a,this},this.setSignUpToken=function(a){return b.signUpToken=a,this},this.setAppName=function(a){return b.appName=a,this},this.manageDefaultHeaders=function(a){return void 0==a&&(a=!0),b.isManagingDefaultHeaders=a,this},this.$get=["$q",function(a){return new g(a)}]}).run(["$injector","$location",function(b){b.invoke(["$http","$cookieStore",function(b,c){a=c,f=b}]),c.set();var d=/\?(data|error)=(.+)/,e=d.exec(location.href);if(e&&e[1]&&e[2]){var g={};g[e[1]]=JSON.parse(decodeURI(e[2].replace("#",""))),window.opener.postMessage(JSON.stringify(g),location.origin),window.close()}}])}();