/*
* Angular SDK to use with backand 
* @version 1.6.0 - 2015-05-21
* @link https://backand.com 
* @author Itay Herskovits 
* @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(){"use strict";var a,b,c,d,e;angular.module("backand",["ngCookies"]).provider("Backand",function(){function f(a){this.signin=function(f,g,h){var i=a.defer();return d.remove(),c.clear(),e({method:"POST",url:b.apiUrl+"/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];return angular.forEach(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.join("&")},data:{grant_type:"password",username:f,password:g,appname:h}}).success(function(a){angular.isDefined(a)&&null!=a?angular.isDefined(a.access_token)&&(b.token="bearer "+a.access_token,d.set(b.token),c.set(),i.resolve(b.token)):i.reject("token is undefined")}).error(function(a){i.reject(a)}),i.promise},this.signout=function(){return d.remove(),c.clear(),a.when(!0)},this.signup=function(a,c,d,f,g){return e({method:"POST",url:b.apiUrl+"/1/user/signup",headers:{SignUpToken:b.signUpToken},data:{firstName:a,lastName:c,email:d,password:f,confirmPassword:g}})},this.forgotPassword=function(a){return e({method:"POST",url:b.apiUrl+"/api/account/SendChangePasswordLink",data:{username:a}})},this.resetPassword=function(a,c){return e({method:"POST",url:b.apiUrl+"/api/account/changePassword",data:{confirmPassword:a,password:a,token:c}})},this.getToken=function(){return d.get()},this.getTokenName=function(){return b.tokenName},this.getApiUrl=function(){return b.apiUrl}}b={apiUrl:"https://api.backand.com:8080",tokenName:"backand_token",anonymousToken:null,signUpToken:null,isManagingDefaultHeaders:!1},d={get:function(){return a.get(b.tokenName)},set:function(c){a.put(b.tokenName,c)},remove:function(){a.remove(b.tokenName)}},c={set:function(){if(b.isManagingDefaultHeaders){var a=d.get();angular.isDefined(a)&&(e.defaults.headers.common.Authorization=a),b.anonymousToken&&(e.defaults.headers.common.AnonymousToken=b.anonymousToken)}},clear:function(){b.isManagingDefaultHeaders&&(e.defaults.headers.common.Authorization&&delete e.defaults.headers.common.Authorization,e.defaults.headers.common.AnonymousToken&&delete e.defaults.headers.common.AnonymousToken)}},this.getApiUrl=function(){return b.apiUrl},this.setApiUrl=function(a){return b.apiUrl=a,this},this.getTokenName=function(a){return b.tokenName},this.setTokenName=function(a){return b.tokenName=a,this},this.setAnonymousToken=function(a){return b.anonymousToken=a,this},this.setSignUpToken=function(a){return b.signUpToken=a,this},this.manageDefaultHeaders=function(a){return void 0==a&&(a=!0),b.isManagingDefaultHeaders=a,this},this.$get=["$q",function(a){return new f(a)}]}).run(["$injector",function(b){b.invoke(["$http","$cookieStore",function(b,c){a=c,e=b}]),c.set()}]),angular.module("backand.utils",[]).provider("BackandUtils",function(){this.$get=["$http","$q","$upload",function(a,c,e){this.uploadFile=function(a,f,g){var h=c.defer();return e.upload({url:b.apiUrl+"/1/file/upload/"+f+"/"+g,file:a,headers:{Authorization:d.get()}}).success(function(a){var b={message:"",url:"",success:!1};a.files[0].success?(b.url=a.files[0].url,b.success=!0):(b.message=a.files[0].error,b.success=!1),h.resolve(b)}).error(function(a){var b={message:"",url:"",success:!1};b.message=a.Message,b.success=!1,h.resolve(b)}),h.promise}}]}),angular.module("backand.orm",[]).provider("BackandORM",function(){this.$get=["Restangular","Backand",function(a,b){function c(b){function c(){a.setResponseExtractor(function(a,b){return"getList"!==b||angular.isArray(a)?a:a.data}),a.setRestangularFields({id:"__metadata.id",route:"restangularRoute",selfLink:"self.href"}),a.setBaseUrl(b.apiUrl+"/1/objects")}function d(b){a.setDefaultHeaders({Authorization:b})}function e(){a.setDefaultHeaders({Authorization:""})}var f={};return f.config=c,f.setCredentials=d,f.clearCredentials=e,f}return c(b.configuration)}]})}();